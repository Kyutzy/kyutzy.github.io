<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wielki Wy≈õcig - A Grande Corrida M√≠stica</title>
    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* --- FUNDO M√çSTICO --- */
        #star-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .star {
            position: absolute; background: white; border-radius: 50%; opacity: 0;
            animation: twinkle var(--duration) ease-in-out infinite;
            box-shadow: 0 0 4px #fff;
        }
        @keyframes twinkle { 0%, 100% { opacity: 0; transform: scale(0.5); } 50% { opacity: var(--max-opacity); transform: scale(1.2); } }

        .fog-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 200px; pointer-events: none; z-index: 0; opacity: 0.5; }
        .fog-wave {
            position: absolute; bottom: 0; left: 0; width: 200%; height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%234a4a8a' fill-opacity='0.4' d='M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: repeat-x; background-position: bottom; animation: moveFog 20s linear infinite;
        }
        @keyframes moveFog { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* --- SETUP SCREEN --- */
        #setup-screen {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; transition: opacity 0.5s, transform 0.5s; z-index: 10;
        }
        h1 {
            color: #ffd700; text-transform: uppercase; letter-spacing: 4px; margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6); font-size: 2.5em; text-align: center;
        }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 500px; position: relative; }
        input {
            flex: 1; padding: 15px 20px; border-radius: 30px; border: 2px solid #ffd700;
            outline: none; font-size: 1.1em; background: rgba(0, 0, 0, 0.6); color: white;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); transition: all 0.3s;
        }
        input:focus { box-shadow: 0 0 25px rgba(255, 215, 0, 0.5); }
        button.add-btn {
            padding: 15px 30px; border-radius: 30px; border: none; background: #ffd700;
            color: #1a1a2e; font-weight: 800; cursor: pointer; transition: all 0.2s;
            text-transform: uppercase; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }
        button.add-btn:hover { transform: scale(1.1); background: #fff; }
        .name-list {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; width: 100%; max-width: 800px;
            height: 35vh; overflow-y: auto; padding: 10px;
        }
        .name-list::-webkit-scrollbar { display: none; }
        .name-tag {
            background: rgba(255, 255, 255, 0.1); padding: 8px 15px; border-radius: 20px;
            display: flex; align-items: center; gap: 10px; border: 1px solid rgba(255,255,255,0.2);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .remove-x { cursor: pointer; color: #ff6b6b; font-weight: bold; }
        #start-race-btn {
            margin-top: 30px; padding: 20px 60px; font-size: 1.5em; font-weight: bold;
            background: linear-gradient(90deg, #ff8e53, #ff6b6b); color: white; border: none;
            border-radius: 50px; cursor: pointer; box-shadow: 0 0 30px rgba(255, 107, 107, 0.4);
            transition: all 0.3s; animation: pulseBtn 2s infinite; letter-spacing: 2px;
        }

        /* --- PISTA --- */
        #race-track {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; z-index: 5;
        }

        /* Porta M√≠stica (Somente Porta) */
        .portal-door {
            position: absolute; right: 80px; top: 50%; transform: translateY(-50%);
            font-size: 8em; z-index: 1; filter: drop-shadow(0 0 30px #ffd700);
            animation: pulsePortal 3s infinite ease-in-out;
        }

        /* Corredores */
        .racer {
            position: absolute; display: flex; flex-direction: column; align-items: center;
            width: 90px; z-index: 10; 
            transform-origin: center center; /* IMPORTANTE para alinhar o rastro */
        }
        .racer-emoji {
            font-size: 4em; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5));
            transition: transform 0.2s;
        }
        .racer-name {
            font-size: 0.9em; background: rgba(0,0,0,0.8); padding: 4px 10px; border-radius: 10px;
            white-space: nowrap; color: #ffd700; border: 1px solid #ffd700; margin-top: -10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); font-weight: bold;
        }

        /* Rastro M√°gico */
        .trail-dot {
            position: absolute; width: 10px; height: 10px; background: #ffd700;
            border-radius: 50%; pointer-events: none; animation: fadeTrail 0.5s forwards ease-out;
            box-shadow: 0 0 8px #fff, 0 0 15px #ffd700;
            filter: blur(1px);
        }

        /* --- MODAL --- */
        #winner-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.8s; overflow: hidden;
        }
        #winner-modal.visible { opacity: 1; pointer-events: auto; }
        .winner-emoji-display { font-size: 10em; animation: bounce 1s infinite; filter: drop-shadow(0 0 30px #ffd700); z-index: 102; }
        .winner-title { font-size: 2em; color: #a8a8c0; margin-top: 20px; text-transform: uppercase; letter-spacing: 3px; z-index: 102; }
        .winner-name-display { font-size: 5em; font-weight: 800; color: #ffd700; text-shadow: 0 0 30px rgba(255, 107, 107, 0.8); margin: 10px 0 40px 0; text-transform: uppercase; z-index: 102; }
        #winner-modal .add-btn { z-index: 102; }

        /* Confetti */
        .confetti {
            position: absolute; top: -20px; z-index: 101;
            width: 10px; height: 10px; background: #ffd700;
            animation: fall 4s linear forwards;
        }

        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        @keyframes pulseBtn { 0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(255, 107, 107, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); } }
        @keyframes pulsePortal { 0%, 100% { transform: translateY(-50%) scale(1); filter: drop-shadow(0 0 20px #ffd700); } 50% { transform: translateY(-50%) scale(1.1); filter: drop-shadow(0 0 50px #ff6b6b); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }
        @keyframes fadeTrail { to { opacity: 0; transform: scale(0.5); } }
        @keyframes fall { to { transform: translateY(110vh) rotate(720deg); } }

    </style>
</head>
<body>

    <div id="star-container"></div>
    <div class="fog-container"><div class="fog-wave"></div></div>

    <div id="setup-screen">
        <h1>üèÜ Wielki Wy≈õcig But√≥w üèÜ<br><span style="font-size: 0.5em; color: #ccc; font-weight: normal;">(A Grande Corrida dos Sapatos)</span></h1>
        <div class="input-group">
            <input type="text" id="nameInput" placeholder="Digite um nome..." onkeypress="handleEnter(event)">
            <button class="add-btn" onclick="addName()">Add</button>
        </div>
        <div class="name-list" id="nameList"></div>
        <button id="start-race-btn" onclick="startRaceAnimation()" style="display: none;">INICIAR O RITUAL</button>
    </div>

    <div id="race-track">
        <div class="portal-door">üö™</div>
    </div>

    <div id="winner-modal">
        <div class="winner-emoji-display" id="winEmoji">üëü</div>
        <div class="winner-title">A Porta se Abre Para:</div>
        <div class="winner-name-display" id="winName">NOME</div>
        <button class="add-btn" onclick="location.reload()">Novo Destino</button>
    </div>

    <script>
        const themeEmojis = ['üë†', 'ü•æ', 'üëü', 'üë¢', 'üëû', 'ü©∞', 'üß¶', 'üëë', 'üé©', 'ü¶Ñ', 'üê≤', 'üçÑ', 'üîÆ', 'üïØÔ∏è', 'üóùÔ∏è'];

        let participants = [];
        let racers = [];
        const finishLineX = window.innerWidth - 250;
        const startX = 50;
        const stepSize = 90;

        function createStars() {
            const container = document.getElementById('star-container');
            for (let i = 0; i < 60; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                star.style.setProperty('--max-opacity', Math.random() * 0.7 + 0.3);
                container.appendChild(star);
            }
        }
        createStars();

        function handleEnter(e) { if (e.key === 'Enter') addName(); }
        function addName() {
            const input = document.getElementById('nameInput');
            const rawText = input.value.trim();
            if (!rawText) return;
            const names = rawText.split(/[\n,]+/).map(n => n.trim()).filter(n => n);
            names.forEach(name => { participants.push(name); renderTag(name); });
            input.value = '';
            checkStartButton();
            document.getElementById('nameList').scrollTop = document.getElementById('nameList').scrollHeight;
        }
        function renderTag(name) {
            const list = document.getElementById('nameList');
            const tag = document.createElement('div');
            tag.className = 'name-tag';
            tag.innerHTML = `<span>${name}</span> <span class="remove-x" onclick="removeName('${name}', this)">√ó</span>`;
            list.appendChild(tag);
        }
        function removeName(name, element) {
            participants = participants.filter(p => p !== name);
            element.parentElement.remove();
            checkStartButton();
        }
        function checkStartButton() {
            document.getElementById('start-race-btn').style.display = participants.length > 1 ? 'block' : 'none';
        }

        function startRaceAnimation() {
            const setup = document.getElementById('setup-screen');
            setup.style.opacity = 0;
            setup.style.transform = "scale(1.5)";
            playSound('start');
            setTimeout(() => {
                setup.style.display = 'none';
                document.getElementById('race-track').style.display = 'block';
                initRacers();
            }, 800);
        }

        function initRacers() {
            const track = document.getElementById('race-track');
            participants.sort(() => Math.random() - 0.5);
            participants.forEach((name, index) => {
                const el = document.createElement('div');
                el.className = 'racer';
                const emoji = themeEmojis[Math.floor(Math.random() * themeEmojis.length)];
                el.innerHTML = `<div class="racer-emoji">${emoji}</div><div class="racer-name">${name}</div>`;
                const x = startX + (index * 60);
                const y = window.innerHeight / 2 + 50;
                el.style.transform = `translate(${x}px, ${y}px)`;
                track.appendChild(el);
                racers.push({ element: el, name: name, emoji: emoji, x: x, y: y });
            });
            setTimeout(nextStep, 1000);
        }

        function nextStep() {
            const movingRacer = racers.shift();
            const leader = racers[racers.length - 1];
            const targetX = leader.x + stepSize;
            
            const startX = movingRacer.x;
            const startY = movingRacer.y;
            const peakY = startY - 250;
            
            const duration = 600;
            const startTime = performance.now();
            
            movingRacer.element.style.zIndex = 100;
            movingRacer.element.querySelector('.racer-emoji').style.transform = "rotate(20deg)";
            
            playSound('jump');

            function animateJump(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentX = startX + (targetX - startX) * progress;
                const height = Math.sin(progress * Math.PI) * (startY - peakY);
                const currentY = startY - height;

                // Move o elemento
                movingRacer.element.style.transform = `translate(${currentX}px, ${currentY}px) scale(${1 + Math.sin(progress * Math.PI)*0.5})`;
                
                // RASTRO PERFEITO:
                // Cria uma part√≠cula em TODO frame para ficar cont√≠nuo.
                // Ajuste de offset para sair do centro/baixo do emoji
                // 45px = metade da largura do container (90px)
                // 50px = altura aproximada para ficar na "sola" do sapato
                createTrail(currentX + 45, currentY + 50);

                if (progress < 1) {
                    requestAnimationFrame(animateJump);
                } else {
                    movingRacer.x = targetX;
                    movingRacer.element.style.zIndex = 10 + racers.length;
                    movingRacer.element.style.transform = `translate(${targetX}px, ${startY}px) scale(1)`;
                    movingRacer.element.querySelector('.racer-emoji').style.transform = "rotate(0deg)";
                    racers.push(movingRacer);

                    if (targetX >= finishLineX) {
                        declareWinner(movingRacer);
                    } else {
                        const delay = targetX > finishLineX / 2 ? 400 : 700;
                        setTimeout(nextStep, delay);
                    }
                }
            }
            requestAnimationFrame(animateJump);
        }

        function createTrail(x, y) {
            const track = document.getElementById('race-track');
            const dot = document.createElement('div');
            dot.className = 'trail-dot';
            // Centraliza o ponto
            dot.style.left = (x - 5) + 'px'; 
            dot.style.top = (y - 5) + 'px';
            track.appendChild(dot);
            // Remove r√°pido para n√£o pesar
            setTimeout(() => dot.remove(), 400);
        }

        function declareWinner(winner) {
            playSound('win');
            winner.element.style.transition = "all 1s ease-in";
            winner.element.style.transform = `translate(${winner.x + 150}px, ${winner.y}px) scale(0)`;
            winner.element.style.opacity = 0;

            setTimeout(() => {
                document.getElementById('winName').innerText = winner.name;
                document.getElementById('winEmoji').innerText = winner.emoji;
                document.getElementById('winner-modal').classList.add('visible');
                createConfetti();
            }, 800);
        }

        function createConfetti() {
            const modal = document.getElementById('winner-modal');
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#ffffff', '#ff8e53'];
            for (let i = 0; i < 150; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + '%';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.animationDuration = (Math.random() * 2 + 2) + 's';
                conf.style.animationDelay = (Math.random() * 1) + 's';
                const size = Math.random() * 8 + 5 + 'px';
                conf.style.width = size;
                conf.style.height = size;
                modal.appendChild(conf);
                setTimeout(() => conf.remove(), 5000);
            }
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            if (type === 'jump') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now); osc.stop(now + 0.3);
                
                const osc2 = audioCtx.createOscillator();
                const gain2 = audioCtx.createGain();
                osc2.connect(gain2); gain2.connect(audioCtx.destination);
                osc2.type = 'triangle';
                osc2.frequency.setValueAtTime(800, now);
                osc2.frequency.linearRampToValueAtTime(1200, now + 0.1);
                gain2.gain.setValueAtTime(0.05, now);
                gain2.gain.linearRampToValueAtTime(0, now + 0.1);
                osc2.start(now); osc2.stop(now + 0.1);
            } else if (type === 'start') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 1);
                gain.gain.setValueAtTime(0.5, now);
                gain.gain.linearRampToValueAtTime(0, now + 1.5);
                osc.start(now); osc.stop(now + 1.5);
            } else if (type === 'win') {
                const notes = [523.25, 659.25, 783.99, 1046.50];
                notes.forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'sine'; o.frequency.value = freq;
                    g.gain.setValueAtTime(0, now);
                    g.gain.linearRampToValueAtTime(0.1, now + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, now + 2);
                    o.start(now + i*0.05); o.stop(now + 2.5);
                });
            }
        }
    </script>
</body>
</html>